{"title":"问题精析：骨骼层级及坐标空间变换","date":"2020-07-30T17:29:55.000Z","date_formatted":{"ll":"Jul 31, 2020","L":"07/31/2020","MM-DD":"07-31"},"link":"2020/07/31/问题精析：骨骼层级及坐标空间变换","tags":["计算机图形学"],"categories":["问题精析"],"updated":"2020-08-01T18:03:51.386Z","content":"<script type=\"text/javascript\" async src=\"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML\"></script>\n<h2 id=\"重点矩阵知识\">重点矩阵知识<a title=\"#重点矩阵知识\" href=\"#重点矩阵知识\"></a></h2>\n<p>  要记住，将A坐标系通过旋转，平移等矩阵操作变换到B坐标系的时候，整合所有变换矩阵所得到的是<strong>B空间转换到A空间的转换矩阵</strong>！</p>\n<h2 id=\"默认姿势（default-pose）\">默认姿势（default pose）<a title=\"#默认姿势（default-pose）\" href=\"#默认姿势（default-pose）\"></a></h2>\n<p>  在导入模型时，我们常常会看到T字形的人物，这是最常用的默认姿势。目的是为了方便变换矩阵的计算（后详述）。</p>\n<h2 id=\"骨骼层级\">骨骼层级<a title=\"#骨骼层级\" href=\"#骨骼层级\"></a></h2>\n<img src=\"/2020/07/31/%E9%97%AE%E9%A2%98%E7%B2%BE%E6%9E%90%EF%BC%9A%E9%AA%A8%E9%AA%BC%E5%B1%82%E7%BA%A7%E5%8F%8A%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E5%8F%98%E6%8D%A2/1.png\" class=\"\">\n<p>  一般来说盆骨是根节点。</p>\n<h2 id=\"坐标空间变换\">坐标空间变换<a title=\"#坐标空间变换\" href=\"#坐标空间变换\"></a></h2>\n<img src=\"/2020/07/31/%E9%97%AE%E9%A2%98%E7%B2%BE%E6%9E%90%EF%BC%9A%E9%AA%A8%E9%AA%BC%E5%B1%82%E7%BA%A7%E5%8F%8A%E5%9D%90%E6%A0%87%E7%A9%BA%E9%97%B4%E5%8F%98%E6%8D%A2/2.png\" class=\"\">\n<p>  在导入模型时，我们会先得到其物体空间（Object Space，下称整体物体空间）下的坐标，而仅仅这样对于活动骨骼来说仍然非常的不方便。如上图，我们期望在活动前臂时能有一个以前臂和大臂交点为坐标原点的坐标空间（称为骨骼物体空间）来帮助我们。为了得到骨骼物体空间，我们先在标准姿势下完成从骨骼物体空间到整体物体空间的转换，之后再对其求逆，得到整体物体空间到骨骼物体空间的变换，来方便我们对骨骼进行操作。</p>\n<p>  （以下操作假设在二维）根据矩阵知识，将上臂的坐标空间平移4单位即可得到前臂的坐标空间，于是前臂的坐标空间到上臂坐标空间的转换矩阵为<br>\n$$<br>\n\\begin{pmatrix}<br>\n1 &amp; 0 &amp; 4\\\\<br>\n0 &amp; 1 &amp; 0\\\\<br>\n0 &amp; 0 &amp; 1\\\\</p>\n<p>\\end{pmatrix}<br>\n$$<br>\n  类似的，我们可以层层递推出其余骨骼到整体物体空间的转换矩阵。我们用1表示盆骨（pelvis），2表示脊柱（spine）等，用下标d表示toDefault，用下标p表示toParent。则可得到关系：<br>\n$$<br>\nM_{1,d} = M_{1,d}<br>\nM_{2,d} = M_{1,d}M{2,p}<br>\nM_{3,d} = M_{2,d}M{3,p}<br>\nM_{i,d} = M_{i-1,d}M{i,p}<br>\n$$<br>\n  对其求逆即可得到我们需要的矩阵<br>\n$$<br>\nM_{i,d}^{-1} = M_{i,p}^{-1}M_{i-1,d}^{-1}<br>\n$$<br>\n  需要注意的是Mp矩阵仅仅是在默认姿势下的转换！如果有旋转之类的操作，还需另外的变换矩阵！前向运动学中详述。</p>\n<h2 id=\"参考资料\">参考资料<a title=\"#参考资料\" href=\"#参考资料\"></a></h2>\n<p>   1. <a href=\"\">JungHyun Han - 3D Graphics for Game Programming-CRC Press (2011)</a></p>\n","prev":{"title":"问题3：堆盘子","link":"2020/07/31/问题3：堆盘子"},"next":{"title":"问题精析：裁剪技术（Culling Techniques）","link":"2020/07/30/问题精析：裁剪技术（Culling Techniques）"},"plink":"http://Ssssshinji.github.io/2020/07/31/问题精析：骨骼层级及坐标空间变换/","toc":[{"id":"重点矩阵知识","title":"重点矩阵知识","index":"1"},{"id":"默认姿势（default-pose）","title":"默认姿势（default pose）","index":"2"},{"id":"骨骼层级","title":"骨骼层级","index":"3"},{"id":"坐标空间变换","title":"坐标空间变换","index":"4"},{"id":"参考资料","title":"参考资料","index":"5"}]}