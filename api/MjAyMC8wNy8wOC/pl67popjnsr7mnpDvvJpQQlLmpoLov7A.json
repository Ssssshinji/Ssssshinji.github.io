{"title":"问题精析：PBR概述","date":"2020-07-08T14:09:16.000Z","date_formatted":{"ll":"Jul 8, 2020","L":"07/08/2020","MM-DD":"07-08"},"link":"2020/07/08/问题精析：PBR概述","tags":["计算机图形学"],"categories":["问题精析"],"updated":"2020-07-12T11:01:04.584Z","content":"<script type=\"text/javascript\" async src=\"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML\"></script>\n<p>  PBR是近来一个新的，有意思的实时渲染方式。这个术语已经被传播得很广泛，但他的真实含义往往是混淆的。简单的回答是：这意味着很多。或者：这得看情况。这种回答并不能使人满意。所以我尝试着将PBR的真实含义，和它与传统的流程详细的解释清楚。这个文档主要是针对美术人员而非工程师。不会涉及数学或者代码类的东西。<br>\n  PBR和传统流程最主要的区别在于他<strong>更详细和科学的还原了光照和物理表面的关系原理</strong>。他的纹理系统已经大大的进化。而旧的生产流程和近似的表达方式可以安全的抛弃了。这代表着无论是工程师还是美术工作人员都需要理解这些变化的动机在哪里。<br>\n  我们需要从一些最基础的东西开始。这样我们可以在讲一些新东西之前对一些基本的概念有清楚的认识。你可能会觉得我讲的这些部分太枯燥乏味，但读过之后你会知道这些东西是值得的。你也可以了解一下Joe Wilson的文章：<a href=\"http://www.marmoset.co/toolbag/learn/pbr-practice\" target=\"_blank\">creating PBR artwork</a>。</p>\n<h2 id=\"散射和反射(diffusion-and-reflection))\">散射和反射(Diffusion and Reflection))<a title=\"#散射和反射(diffusion-and-reflection))\" href=\"#散射和反射(diffusion-and-reflection))\"></a></h2>\n<p>  Diffusion和Reflection。也被叫做diffuse和specular。是描述光和物体表面互相作用的最基础的两个术语。很多人知道他们在实际应用中是怎么样的。但并不知道他们的物理原理是什么。<br>\n  当光照射到物体的表面时，他会反射一部分，或者说反弹一部分。从表面的一边反弹到镜像的另一边。就像一个球打在地面上并弹起来一样。在光滑的表面上，会有像镜子一样的效果。单词specular，就是用来描述这种现象的。而specular正是拉丁语中镜子的意思。<br>\n<img src=\"https://pic1.zhimg.com/80/41b6e086c47de7dc6b35e14e717487e8_720w.jpg\" alt=\"\"><br>\n  然而并不是所有的光线都会从表面直接反射。有些光线会在进入被照射物体的内部。这些进入物体内部的光线有的会被物体吸收（往往会转变为热量消耗掉），而有些散射光线会在物体内散射后又从表面散射出去。然后被我们的肉眼或者摄像机看到。像diffuse，diffsion，3S（SSS）等都是表达的这个物理现象。<br>\n  对不同波长的光，它的反射和吸收的量是差别很大的。这就让物体有了颜色（例子：如果白光照射在物体上，大部分的光线都被吸收掉了，而只反射出蓝色，那这个物体就是蓝色的）。这种散射是均匀而散乱的往各个向散射过去的。这和镜面反射完全不同。我们在shader上用<strong>albedo</strong>来表达这些散射颜色。<strong>Diffuse color</strong>是和这个同义的短语。</p>\n<h2 id=\"半透明和全透明(translucency-and-transparentcy)\">半透明和全透明(Translucency and Transparentcy)<a title=\"#半透明和全透明(translucency-and-transparentcy)\" href=\"#半透明和全透明(translucency-and-transparentcy)\"></a></h2>\n<p>  有时候diffuse是蛮复杂的。在有些材质中，散射的距离会更广，更远。比如说像皮肤或者蜡这些材质。这时候用一个简单的颜色来表示是不够的。引擎会要计算物体的形状或者厚度。如果物体足够薄，就可以看到光从物体的背面照射出来（就好像光穿过人的手），这就是translucent（半透明）。如果散射更低，比如说玻璃，几乎所有的光线都直接穿过，以至于你可以看到背面的图像。这些属性都和“物体表面的散射”相去甚远。这时引擎需要一个单独的shader来模拟这些现象。</p>\n<h2 id=\"能量守恒(energy-conservation)\">能量守恒(Energy Conservation)<a title=\"#能量守恒(energy-conservation)\" href=\"#能量守恒(energy-conservation)\"></a></h2>\n<p>  有了这些描述后我们就有足够的信息去得到一个重要的结论：<strong>散射diffusion和反射reflection是相互排斥的（要么就散射，要么就反射）这也是传统光照模型所忽略的。</strong>。这是因为：如果光要散射，他就必须要在物体表面内传播，也就是不能反射。这就是照明系统中的“能量守恒定理”：从一个物体表面散射或反射的光线永远不会比原本照射他的光线要亮。<br>\n  这很容易被引擎执行：在diffuse执行之前先把反射的那部分光线减去。这意味着高反射的物体的diffuse会很少很黑，因为大部分的光线都被反射掉了，几乎不能在物体的表面散射。下面这种守恒也是同样成立的：如果一个物体有非常亮的diffuse，那他也不会有什么反射。<br>\n  这种能量守恒是PBR的一个重要的部分。这让艺术家能够基于物理的原理来调整albedo和reflective的值，而不是违背物理原理（这往往会看起来很low很糟糕）。虽然严格的执行这些规律和创造屌炸天的艺术作品并没有什么必然的联系。但它能起到一个“物理学保姆”（比喻）的角色。这能保护你的作品不会偏离规律太远。或者在不同的光照条件下得到前后矛盾的效果（不同光照下的表现相差很多）。</p>\n<h2 id=\"金属(metals)\">金属(Metals)<a title=\"#金属(metals)\" href=\"#金属(metals)\"></a></h2>\n<p>  1.首先，导体（金属）会比绝缘体（非金属）的反射要高的多得多得多。导体一般会反射高达60－90%的光线，而绝缘体会少得多，一般在0-20%的范围内。这种高反射避免了光线进入到物体表面内部散射，给金属一种光亮的效果。<br>\n  2.其次，导体的反射有时会在可见光谱中变化，这意味着<strong>他们的反射是有颜色倾向的</strong>。这种反射颜色在不同的导体上也是不同的。比如说：金，铜，黄铜，都是不一样的。而绝缘体不会有这种现象，他们的反射是不带颜色的 <strong>（一般是某种深度的灰色的）</strong>。<br>\n  3.最后，导体一般会吸收没有反射的光线，而不是在表面散射。这个规律意味着金属是没有diffuse颜色的。但是注意：在现实情况中，金属表面会有一些物体（比如灰尘）和氧化物会产生一些固有色。<strong>（这里存疑，因为有的地方讲diffuse和固有色是同一个东西）</strong></p>\n<h2 id=\"菲涅尔(fresnel)\">菲涅尔(Fresnel)<a title=\"#菲涅尔(fresnel)\" href=\"#菲涅尔(fresnel)\"></a></h2>\n<p>  奥古斯丁菲涅尔第一个准确的描述了菲涅尔这个现象。如果我们要谈论光线的反射，那就绕不开这种现象。<br>\n  在计算机图形学中，菲涅尔指的是在不同角度下，反射的变化现象。特别是：光在一个小掠角射到一个表面的反射会比垂直照射到一个表面要多得多。这意味着一个有着正确菲涅尔效果的物体，在它的边缘位置反射会比中间位置的反射会强很多。我们已经对这个效果很熟悉了，而在计算机图形学领域中，菲涅尔也不是一个新词。不过，PBR系统对菲涅尔方程式做了几个重要的修正。<br>\n  首先，对所有的材质，在很小的角度看，反射都会很强烈。在极为边缘或者小角度的地方，任何材质都会反射得像一面镜子一样。是的，任何材质，只要平滑，并从对的角度观察，都会像是一面完美的镜子。这有违常理，不过实际上就是这样子的。<br>\n  第二个有关于菲涅尔属性的结论是。不同的材质之间，菲涅尔曲线的变化差异<strong>并不大</strong>。金属的差异大一些，但也还是可以分析和记录的。<br>\n  那这对于我们意味着，获得一个真实的效果。艺术家应该更少的控制菲涅尔属性，而不是更多的控制它。<br>\n  这里有个关于菲涅尔效果的警告。在一个表面越粗糙的时候，菲涅尔效果会越<strong>不</strong>明显。下文会讲述更多的关于这方面的信息。</p>\n<h2 id=\"微表面(microsurface)\">微表面(Microsurface)<a title=\"#微表面(microsurface)\" href=\"#微表面(microsurface)\"></a></h2>\n<p>  以上对于反射（reflection）和漫反射（diffusion）的描述都是是<strong>基于物体表面朝向的</strong>。从一个正常的观察尺度来说，这种表面朝向是基于物体的形状的。而法线贴图也会在描述更加小一些的形状细节。渲染引擎能基于这些信息来渲染diffuse和reflection信息。<br>\n  但是这里还有一个很大的部分被忽略掉了。大部分真实世界的表面都有很多不完美的地方：小凹槽，破损，小突起等细节。<strong>这些细节肉眼是看不到的</strong>。正常分辨率的法线贴图也不能体现这些小细节。虽然不能被肉眼看到，这种小细节仍然会对光的diffsion和reflection产生影响。<br>\n<img src=\"https://pic4.zhimg.com/80/85e93632f88e18f46cc9b73729c31a93_720w.jpg\" alt=\"\"><br>\n  微表面的细节影响最显著的是<strong>反射 Specular</strong>（次表面散射影响不明显，所以我们不会在这里过多的讨论）。从上面的图我们可以看到平行光线照射到粗糙的表面后会分散的反射开来，因为每一束光和表面碰撞的方向都是不同的。我们用球碰墙的模拟，在一个类似于崖壁或者类似的不平整的表面：当球打到一个表面时，反弹的角度是不可预期的。简单的讲，<strong>越是粗糙的表面，越多的反射光线会分散，呈现一种模糊的效果。</strong><br>\n  可惜的是。定义每一个不同的微表面是不实际的。因为工作流程，内存控制，计算量都做不到。那么咋整呢？我们可以不用直接描述每一个不同的微表面。而是定义一个大概的粗糙程度。那样我们也可以获得一个十分接近而准确的效果。这种值往往叫做Gloss，Smoothness，或者Roughness。你可以通过贴图定义他们，或者给不同的材质定义不同的值。<br>\n  微表面的细节是一个材质的重要组成部分。因为在实际生活中有大量的，广泛的，不同的微表面特征。光泽度贴图（gloss mapp）不是一个新的概念。但它还是在PBR渲染中扮演了重要的角色。因为微表面细节对光的反射有重大的影响。下面我们马上会讲到PBR系统对微表面属性的若干方面的提升。</p>\n<h2 id=\"守恒定律(包含微表面)\">守恒定律(包含微表面)<a title=\"#守恒定律(包含微表面)\" href=\"#守恒定律(包含微表面)\"></a></h2>\n<p>  当我们将微表面细节纳入到我们的渲染模型，然后准确的散布反射光线。这时就必须正确地反射光线的量。遗憾的是，很多老的渲染引擎都把这个部分搞错了，基于微表面的粗糙度，不是反射过多就是反射过少。<br>\n  当方程式准确平衡的时候，一个引擎需要将粗糙表面的高光变得模糊，而将光滑的表面的高光变得小而尖锐。在亮度上的不同表现关键在于：<strong>两种材质（光滑和粗糙）都会反射同等量的光线，不过粗糙的表面将它散射到不同的方向，而光滑的表面会变得更加的集中。</strong>（不改变反射率便可以使高光的亮度，大小发生改变）<br>\n  微表面光泽度直接影响了反射亮度的表现。这意味着艺术家可以直接在光泽度贴图直接绘制不同的变化：划痕，凹痕，磨损，磨光，等等。于此同时PBR系统不仅会改变反射的样子，也会相应地改变亮度。再也不需要“spec蒙版”“反射贴图”变化了!（从而决定了PBR和传统渲染有很大程度上的区别）<br>\n  这意义重大。因为这两个真实世界中的量是基于物理相关的——<strong>微表面细节和反射度</strong>——现在第一次在艺术领域和渲染流程中被准确地联系在了一起。这十分像我们之前讲的diffusion/reflection平衡：我们可以独立的制定两个独立的值，但一但我们将它们联系起来，区别它们就会变得更加的困难。<br>\n  进一步说，显示世界中的材质的反射值的变化不会很大（参见之前我们讲的关于导体的部分）。一个很好的例子是水和泥巴。都有相似的反射率，但是泥巴是十分粗糙的，但它上面的积水却很光滑，它们因为反射性不同的原因而看起来十分的不一样。在PBR系统中，艺术家主要通过gloss或者roughness贴图来区别这种不同。而不是调节反射率：就像下面一样。</p>\n<img src=\"/2020/07/08/%E9%97%AE%E9%A2%98%E7%B2%BE%E6%9E%90%EF%BC%9APBR%E6%A6%82%E8%BF%B0/Gloss.jpg\" class=\"\">\n<h2 id=\"参考资料\">参考资料<a title=\"#参考资料\" href=\"#参考资料\"></a></h2>\n<p>   1. <a href=\"\">基于物理渲染（PBR）的基础理论</a></p>\n","prev":{"title":"问题5：一次编辑","link":"2020/07/09/问题5：一次编辑"},"next":{"title":"问题3：特定深度结点链表","link":"2020/07/08/问题3：特定深度结点链表"},"plink":"http://Ssssshinji.github.io/2020/07/08/问题精析：PBR概述/","toc":[{"id":"散射和反射(diffusion-and-reflection))","title":"散射和反射(Diffusion and Reflection))","index":"1"},{"id":"半透明和全透明(translucency-and-transparentcy)","title":"半透明和全透明(Translucency and Transparentcy)","index":"2"},{"id":"能量守恒(energy-conservation)","title":"能量守恒(Energy Conservation)","index":"3"},{"id":"金属(metals)","title":"金属(Metals)","index":"4"},{"id":"菲涅尔(fresnel)","title":"菲涅尔(Fresnel)","index":"5"},{"id":"微表面(microsurface)","title":"微表面(Microsurface)","index":"6"},{"id":"守恒定律(包含微表面)","title":"守恒定律(包含微表面)","index":"7"},{"id":"参考资料","title":"参考资料","index":"8"}]}